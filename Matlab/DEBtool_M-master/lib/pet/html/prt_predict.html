
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>prt_predict</title><meta name="generator" content="MATLAB 9.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-06-19"><meta name="DC.source" content="prt_predict.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>prt_predict</h1><!--introduction--><p>writes file predict_my_pet.m</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Syntax</a></li><li><a href="#4">Description</a></li><li><a href="#5">Remarks</a></li><li><a href="#6">unpack par, data, auxData</a></li><li><a href="#7">compute temperature correction factors</a></li><li><a href="#8">zero-variate data</a></li><li><a href="#9">pack to output</a></li><li><a href="#10">uni-variate data</a></li><li><a href="#11">pack to output</a></li></ul></div><h2 id="3">Syntax</h2><p>[auxParFld, info] = <a href="../prt_predict.m"><b>prt_predict</b></a> (par, metaPar, data, auxData)</p><h2 id="4">Description</h2><p>Writes file predict_my_pet.m from pars, data, auxData and metaData. Uses code as specified in predict.mat</p><p>Input:</p><div><ul><li>par: structure with parameters (from pars_init)</li><li>metaPar: structure with meta parameters (from pars_init)</li><li>data: structure with data (from mydata)</li><li>auxData: structure with auxiliary data (from mydata)</li><li>metaData: structure with meta data (from mydata)</li></ul></div><p>Output:</p><div><ul><li>auxParFld: cell string with names of auxiliary parameters that are used</li><li>info: boolean for success of filling all code (1), or failure (0)</li></ul></div><h2 id="5">Remarks</h2><p>The file will be saved in your local directory; use the cd command to the dir of your choice BEFORE running this function to save files in the desired place.</p><p>Structure prdCode has model name as first field names</p><div><ul><li>Field res has the name of output variable for zero-variate field names or header text for uni-variate data</li><li>Field aux has the cell string with auxPar for that code.</li><li>Other fields under the model field are names of variables with a cell string of code, each cell containg one code line</li><li>The name of a univariate data set is called fldi in the code; it will be back-substituded before printing</li><li>Remove fields with: prdCode.std = rmfield(prdCode.std, 'Li');</li><li>Rename fields with: prdCode.std = renameStructField(prdCode.std, 'l_i', 'L_i');</li><li>Reorder fields with: prdCode = orderfields(prdCode, cell string with ordered fld names)</li><li>Modify code-line i of variable tWw with: prdCode.std.tWw{i} = 'something';</li><li>Save: WD = cdPet; save('prdCode.mat','prdCode'); cd(WD)</li></ul></div><p>The intended use of this function in the context of AmPeps</p><div><ul><li>first compose a mydata-file</li><li>copy-paste-modify a pars_init file of a related AmP species</li><li>use the outputs of the pars_init and mydata files as inputs of this function to write a predict-file</li><li>modify the aux parameters of pars_init file to the needs of this predict-file using mat2pars_init</li><li>use prt_run_my_pet to write a run-file</li><li>finally: you are ready to start the estimation procedure</li></ul></div><h2 id="6">unpack par, data, auxData</h2><h2 id="7">compute temperature correction factors</h2><h2 id="8">zero-variate data</h2><h2 id="9">pack to output</h2><h2 id="10">uni-variate data</h2><h2 id="11">pack to output</h2><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% prt_predict
% writes file predict_my_pet.m 

%%
function [auxParFld, info] = prt_predict(par, metaPar, data, auxData, metaData)
% created 2020/06/02 by  Bas Kooijman

%% Syntax
% [auxParFld, info] = <../prt_predict.m *prt_predict*> (par, metaPar, data, auxData) 

%% Description
% Writes file predict_my_pet.m from pars, data, auxData and metaData. Uses code as specified in predict.mat
%
% Input:
%
% * par: structure with parameters (from pars_init)
% * metaPar: structure with meta parameters (from pars_init)
% * data: structure with data (from mydata)
% * auxData: structure with auxiliary data (from mydata)
% * metaData: structure with meta data (from mydata)
%
% Output:
%
% * auxParFld: cell string with names of auxiliary parameters that are used
% * info: boolean for success of filling all code (1), or failure (0)

%% Remarks
% The file will be saved in your local directory; 
% use the cd command to the dir of your choice BEFORE running this function to save files in the desired place.
%
% Structure prdCode has model name as first field names
%
% * Field res has the name of output variable for zero-variate field names or header text for uni-variate data
% * Field aux has the cell string with auxPar for that code.
% * Other fields under the model field are names of variables with a cell string of code, each cell containg one code line
% * The name of a univariate data set is called fldi in the code; it will be back-substituded before printing
% * Remove fields with: prdCode.std = rmfield(prdCode.std, 'Li');
% * Rename fields with: prdCode.std = renameStructField(prdCode.std, 'l_i', 'L_i'); 
% * Reorder fields with: prdCode = orderfields(prdCode, cell string with ordered fld names)
% * Modify code-line i of variable tWw with: prdCode.std.tWw{i} = 'something';
% * Save: WD = cdPet; save('prdCode.mat','prdCode'); cd(WD) 
%
% The intended use of this function in the context of AmPeps
%  
% * first compose a mydata-file
% * copy-paste-modify a pars_init file of a related AmP species
% * use the outputs of the pars_init and mydata files as inputs of this function to write a predict-file
% * modify the aux parameters of pars_init file to the needs of this predict-file using mat2pars_init
% * use prt_run_my_pet to write a run-file
% * finally: you are ready to start the estimation procedure

auxParFld = {}; model = metaPar.model; my_pet = metaData.species; 
WD = cdPet; load prdCode; cd(WD);

fid = fopen(['predict_', metaData.species, '.m'], 'w+'); % open file for reading and writing, delete existing content
fprintf(fid, 'function [prdData, info] = predict_%s(par, data, auxData)\n', my_pet);
fprintf(fid, '%% file generated by prt_predict\n\n');

%% unpack par, data, auxData
fprintf(fid, '%% unpack par, data, auxData\n');
fprintf(fid, 'cPar = parscomp_st(par); vars_pull(par);\n'); 
fprintf(fid, 'v2struct(par); v2struct(cPar); v2struct(data); v2struct(auxData);\n\n'); 
    
cPar = parscomp_st(par); vars_pull(par);
v2struct(par); v2struct(cPar); v2struct(data); v2struct(auxData);

% split zero- from uni-variate data
fld = fieldnames(data); fld = fld(~strcmp(fld, 'psd')); n_fld = length(fld); sel = false(n_fld,1);
for i = 1:n_fld
  sel(i) = size(data.(fld{i}),1) > 1;
end
fld0 = fld(~sel); fld1 = fld(sel); n_fld0 = length(fld0); n_fld1 = length(fld1);

%% compute temperature correction factors
fprintf(fid, '%% compute temperature correction factors\n');
if exist('T_L','var') && exist('T_H','var')
  fprintf(fid, 'pars_T = [T_A, T_L, T_H, T_AL, T_AH];\n');
elseif exist('T_AH','var') 
  fprintf(fid, 'pars_T = [T_A, T_H, T_AH];\n');
elseif exist('T_AL','var') 
  fprintf(fid, 'pars_T = [T_A, T_L, T_AL];\n');
else
  fprintf(fid, 'pars_T = T_A;\n');
end
for i = 1:n_fld
  if isfield(temp, fld{i})
    fprintf(fid, 'TC_%s = tempcorr(temp.%s, T_ref, pars_T);\n', fld{i}, fld{i});
  end
end
fprintf(fid, '\n');

%% zero-variate data

% life cycle
fprintf(fid, '%% life cycle\n');
if strcmp(model,'std') && isfield(data, 'tR')
  fprintf(fid, '%s', cell2str(prdCode.(model).lcR));
  auxParFld = [auxParFld, 't_N'];
else
  fprintf(fid, '%s', cell2str(prdCode.(model).lc));
end
fprintf(fid, '\n');

% initial
fld_0 = {'E0', 'Ww0', 'Wd0', 'Wwh', 'Wdh', 'Lh'}; % fields for section initial
sel_0 = ismember(fld0,fld_0);
if any(sel_0)
  fprintf(fid, '%% initial\n');
  fld_0 = fld_0(ismember(fld_0,fld0)); n_fld0 = length(fld_0);
  if any(ismember(fld_0, {'E0', 'Ww0', 'Wd0'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).U_E0));
  end
  for i = 1:n_fld0
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_0{i})));
  end
  fprintf(fid, '\n');
end

% hatch
fld_h = {'ah', 'Lh', 'Wwh', 'Wdh'}; % fields for section hatch
sel_h = ismember(fld0,fld_h);
if any(sel_h)
  fprintf(fid, '%% hatch\n');
  fld_h = fld_h(ismember(fld_h,fld0)); n_fldh = length(fld_h);
  if any(ismember(fld_0, {'ah', 'Lh', 'Wwh', 'Wdh'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).aUL_h));
  end
  for i = 1:n_fldh
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_h{i})));
  end
  fprintf(fid, '\n');
end

% birth
fld_b = {'ab', 'Lb', 'Wwb', 'Wdb'}; % fields for section birth
sel_b = ismember(fld0,fld_b);
if any(sel_b)
  fprintf(fid, '%% birth\n');
  fld_b = fld_b(ismember(fld_b,fld0)); n_fldb = length(fld_b);
  if any(ismember(fld_b, {'Lb', 'Wwb', 'Wdb'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_b));
  end
  for i = 1:n_fldb
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_b{i})));
  end
  fprintf(fid, '\n');
end

% fledging/weaning 
fld_x = {'tx', 'Lx', 'Wwx', 'Wdx'}; % fields for section fledging/weaning
sel_x = ismember(fld0,fld_x);
if any(sel_x)
  fprintf(fid, '%% fledging/weaning\n');
  fld_x = fld_x(ismember(fld_x,fld0)); n_fldx = length(fld_x);
  if any(ismember(fld_x, {'Lx', 'Wwx', 'Wdx'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_x));
  end
  for i = 1:n_fldx
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_x{i})));
  end
  fprintf(fid, '\n');
end

% metamorphosis 
fld_j = {'aj', 'Lj', 'Wwj', 'Wdl'}; % fields for section metamorphosis
sel_j = ismember(fld0,fld_j);
if any(sel_j)
  fprintf(fid, '%% metamorphosis\n');
  fld_j = fld_j(ismember(fld_j,fld0)); n_fldj = length(fld_j);
  if any(ismember(fld_j, {'Lj', 'Wwj', 'Wdj'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_j));
  end
  for i = 1:n_fldj
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_j{i})));
  end
  fprintf(fid, '\n');
end

% puberty
fld_p = {'tp', 'Lp', 'Wwp', 'Wdp'}; % fields for section puberty
sel_p = ismember(fld0,fld_p);
if any(sel_p)
  fprintf(fid, '%% puberty\n');
  fld_p = fld_p(ismember(fld_p,fld0)); n_fldp = length(fld_p);
  if any(ismember(fld_p, {'Lp', 'Wwp', 'Wdp'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_p));
  end
  for i = 1:n_fldp
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_p{i})));
  end
  fprintf(fid, '\n');
end

% ultimate
fld_i = {'Li', 'Wwi', 'Wdi', 'am'}; % fields for section ultimate
sel_i = ismember(fld0,fld_i);
if any(sel_i)
  fprintf(fid, '%% ultimate\n');
  fld_i = fld_i(ismember(fld_i,fld0)); n_fldi = length(fld_i);
  if any(ismember(fld_i, {'Li', 'Wwi', 'Wdi'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_i));
  end
  for i = 1:n_fldi
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_i{i})));
  end
  fprintf(fid, '\n');
end

% reproduction
fld_R = {'Ri', 'tR'}; % fields for section reproduction
sel_R = ismember(fld0,fld_R);
if any(sel_R)
  fprintf(fid, '%% reproduction\n');
  fld_R = fld_R(ismember(fld_R,fld0)); n_fldR = length(fld_R);
  for i = 1:n_fldR
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_R{i})));
  end
  fprintf(fid, '\n');
end

% males
fld_m = {'tpm', 'Lpm', 'Lim', 'Wwpm', 'Wdpm', 'Wwim', 'Wdim', 'tWw_m', 'tWd_m', 'tL_m', 'LdL_m'}; % fields for section males
sel_m = ismember(fld0,fld_m);
if any(sel_m)
  fprintf(fid, '%% males\n');
  fprintf(fid, '%s', cell2str(prdCode.(model).L_mm));
  fld_m = fld_m(ismember(fld_m,fld0)); n_fldm = length(fld_m);
  if any(ismember(fld_m, {'tpm', 'Lpm', 'Wwpm', 'Wdpm'}))
    fprintf(fid, '%s', cell2str(prdCode.(model).L_pm));
  end
  for i = 1:n_fldm
    fprintf(fid, '%s', cell2str(prdCode.(model).(fld_m{i})));
  end
  fprintf(fid, '\n');
end

% remaining zero-variate fields
sel_0 = any([sel_0, sel_h, sel_b, sel_x, sel_j, sel_p, sel_i, sel_R, sel_m], 2); 
rfld0 = fld0(~sel_0); n_rfld0 = length(rfld0);
if n_rfld0 > 0
  fprintf(fid, '%% Warning: The following zero-variate data fields were not recognized\n');
  for i = 1:n_rfld0
    fprintf(fid, '%s = ;\n', rfld0{i});
  end
  fprintf(fid, '\n');
end

%% pack to output
fprintf(fid, '%% pack to output\n');
for i = 1:n_fld0
   if ismember(fld0{i}, rfld0)
     fprintf(fid, 'prdData.%s = ;\n', fld0{i});
   else
     fprintf(fid, 'prdData.%s = %s;\n', fld0{i}, prdCode.res.(fld0{i}));
   end
end
fprintf(fid, '\n');

%% uni-variate data
sel_1 = true(n_fld1,1);
for i = 1:n_fld1
  try
    fldi = fld1{i}; sep = strfind(fldi, '_'); sep1 = sep(1); sep = sep(end);
    if isempty(sep)
      fld = fldi; fld_index = []; % data-type 
    else
      fld = fldi(1:sep1-1); % data-type
      fld_index = fldi(sep+1:end); % data index
    end
    if strcmp(fld_index,'m')
      fld = [fld, '_m'];
    end
    code = cell2str(prdCode.(model).(fld));
    code = strrep(code, 'fldi', fldi); % replace data index
    if isempty(fld_index)
      code = strrep(code, [fld, '_'], fld); % remove underscore of fld
    end
    fprintf(fid, '%% %s\n', prdCode.res.(fld));
    fprintf(fid, '%s', code);
  catch
    sel_1(i) = false;
  end
  fprintf(fid, '\n');
end

% remaining uni-variate fields
rfld1 = fld1(~sel_1); n_rfld1 = length(rfld1);
if n_rfld1 > 0
  fprintf(fid, '%% Warning: The following uni-variate data fields were not recognized\n');
  for i = 1:n_rfld1
    fprintf(fid, '%s = ;\n', rfld1{i});
  end
  fprintf(fid, '\n');
end

%% pack to output
fprintf(fid, '%% pack to output\n');
for i = 1:n_fld1
   if ismember(fld1{i}, rfld1)
     fprintf(fid, 'prdData.%s = ;\n', fld1{i});
   else
     fprintf(fid, 'prdData.%s = %s;\n', fld1{i}, fld1{i});
   end
end
fprintf(fid, '\n');

fclose(fid);

% auxParFld
fld = [fld0(sel_0); fld1(sel_1)]; n_fld = length(fld); 
for i =1:n_fld
  if isfield(prdCode.aux, fld{i})
    auxParFldi = prdCode.aux.(fld{i});
    auxParFld = [auxParFld; auxParFldi(:)];
  end
end
auxParFld = unique(auxParFld);
info = n_rfld0 == 0 && n_rfld1 == 0;

end

function str = cell2str(cell)
  n = length(cell); str = '';
  for i=1:n
    str = [str, cell{i}, char(10)];
  end
end


##### SOURCE END #####
--></body></html>